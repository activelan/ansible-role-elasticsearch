---

- name: 'Install elasticsearch key'
  become: True
  apt_key:
    url: 'https://packages.elastic.co/GPG-KEY-elasticsearch'
    state: 'present'


- name: 'Add elasticsearch repository'
  become: True
  template:
    dest: '/etc/apt/sources.list.d/elasticsearch.list'
    src: "{{ role_path }}/templates/elasticsearch.list.j2"
    group: 'root'
    owner: 'root'
    mode: '0644'


- name: 'Install elasticsearch'
  become: True
  apt:
    name: "{{ item }}"
    state: "{{ elasticsearch_package_state }}"
    update_cache: True
  with_items: "{{ elasticsearch_packages }}"
  notify:
    - 'restart elasticsearch'


- name: 'Create pid dir'
  become: True
  file:
    path: "{{ elasticsearch_path_pid }}"
    state: 'directory'
    owner: 'elasticsearch'
    group: 'elasticsearch'
    mode: '0750'
